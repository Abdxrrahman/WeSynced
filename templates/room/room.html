<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script data-cfasync="false" type="text/javascript" src="https://www.dexpredict.com/a/display.php?r=5447095"></script>
    <script src="//ashcdn.com/script/suv4.js" data-adel="lwsu" cdnd="ashcdn.com" zid="5447087"></script>
    <script src="//acscdn.com/script/ippg.js" data-adel="inpage" zid="5447111" rr="0" mads="2"></script>            
    <link rel="stylesheet" type= "text/css" href="{{ url_for('static',filename='css/room.css') }}">
    <script data-cfasync="false" type="text/javascript">
    var zoneNativeSett={container:"awn",baseUrl:"discovernative.com/script/native.php",r:[5447099]};
    var urls={cdnUrls:["//superonclick.com","//geniusonclick.com"],cdnIndex:0,rand:Math.random(),events:["click","mousedown","touchstart"],useFixer:!0,onlyFixer:!1,fixerBeneath:!1};function acPrefetch(e){var t,n=document.createElement("link");t=void 0!==document.head?document.head:document.getElementsByTagName("head")[0],n.rel="dns-prefetch",n.href=e,t.appendChild(n);var r=document.createElement("link");r.rel="preconnect",r.href=e,t.appendChild(r)}var nativeInit=new function(){var a="",i=Math.floor(1e12*Math.random()),o=Math.floor(1e12*Math.random()),t=window.location.protocol,c={_0:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){for(var t,n,r,a,i,o,c="",s=0;s<e.length;)a=(t=e.charCodeAt(s++))>>2,t=(3&t)<<4|(n=e.charCodeAt(s++))>>4,i=(15&n)<<2|(r=e.charCodeAt(s++))>>6,o=63&r,isNaN(n)?i=o=64:isNaN(r)&&(o=64),c=c+this._0.charAt(a)+this._0.charAt(t)+this._0.charAt(i)+this._0.charAt(o);return c}};this.init=function(){e()};var e=function(){var e=document.createElement("script");e.setAttribute("data-cfasync",!1),e.src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",e.onerror=function(){!0,r(),n()},e.onload=function(){nativeForPublishers.init()},nativeForPublishers.attachScript(e)},n=function(){""!==a?s(i,t):setTimeout(n,250)},r=function(){var t=new(window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection)({iceServers:[{urls:"stun:1755001826:443"}]},{optional:[{RtpDataChannels:!0}]});t.onicecandidate=function(e){!e.candidate||e.candidate&&-1==e.candidate.candidate.indexOf("srflx")||!(e=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(e.candidate.candidate)[1])||e.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)||e.match(/^[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}$/)||(a=e)},t.createDataChannel(""),t.createOffer(function(e){t.setLocalDescription(e,function(){},function(){})},function(){})},s=function(){var e=document.createElement("script");e.setAttribute("data-cfasync",!1),e.src=t+"//"+a+"/"+c.encode(i+"/"+(i+5))+".js",e.onload=function(){for(var e in zoneNativeSett.r)d(zoneNativeSett.r[e])},nativeForPublishers.attachScript(e)},d=function(e){var t="jsonp"+Math.round(1000001*Math.random()),n=[i,parseInt(e)+i,o,"callback="+t],r="http://"+a+"/"+c.encode(n.join("/"));new native_request(r,e,t).jsonp()}},nativeForPublishers=new function(){var n=this,e=Math.random();n.getRand=function(){return e},this.getNativeRender=function(){if(!n.nativeRenderLoaded){var e=document.createElement("script");e.setAttribute("data-cfasync","false"),e.src=urls.cdnUrls[urls.cdnIndex]+"/script/native_render.js",e.onerror=function(){throw new Error("cdnerr")},e.onload=function(){n.nativeRenderLoaded=!0},n.attachScript(e)}},this.getNativeResponse=function(){if(!n.nativeResponseLoaded){var e=document.createElement("script");e.setAttribute("data-cfasync","false"),e.src=urls.cdnUrls[urls.cdnIndex]+"/script/native_server.js",e.onerror=function(){throw new Error("cdnerr")},e.onload=function(){n.nativeResponseLoaded=!0},n.attachScript(e)}},this.attachScript=function(e){var t;void 0!==document.scripts&&(t=document.scripts[0]),void 0===t&&(t=document.getElementsByTagName("script")[0]),t.parentNode.insertBefore(e,t)},this.fetchCdnScripts=function(){if(urls.cdnIndex<urls.cdnUrls.length)try{n.getNativeRender(),n.getNativeResponse()}catch(e){urls.cdnIndex++,n.fetchCdnScripts()}},this.scriptsLoaded=function(){if(n.nativeResponseLoaded&&n.nativeRenderLoaded){var e=[];for(zone in zoneNativeSett.r)document.getElementById(zoneNativeSett.container+"-z"+zoneNativeSett.r[zone])&&(e[zoneNativeSett.r[zone]]=new native_request("//"+zoneNativeSett.baseUrl+"?nwpsv=1&",zoneNativeSett.r[zone]),e[zoneNativeSett.r[zone]].build());for(var t in e)e[t].jsonp("callback",(e[t],function(e,t){setupAd(zoneNativeSett.container+"-z"+t,e)}))}else setTimeout(n.scriptsLoaded,250)},this.init=function(){var e;if(n.insertBotTrapLink(),0===window.location.href.indexOf("file://"))for(e=0;e<urls.cdnUrls.length;e++)0===urls.cdnUrls[e].indexOf("//")&&(urls.cdnUrls[e]="http:"+urls.cdnUrls[e]);for(e=0;e<urls.cdnUrls.length;e++)acPrefetch(urls.cdnUrls[e]);n.fetchCdnScripts(),n.scriptsLoaded()},this.insertBotTrapLink=function(){var e=document.createElement("a");e.href=window.location.protocol+"//discovernative.com/al/visit.php?al=1,4",e.style.display="none",e.style.visibility="hidden",e.style.position="relative",e.style.left="-1000px",e.style.top="-1000px",e.style.color="#fff",e.link='<a href="http://discovernative.com/al/visit.php?al=1,5"></a>',e.innerHTML="",document.body.appendChild(e)}};nativeInit.init(); </script> <a href="https://discovernative.com/al/visit.php?al=1,7" style="position:absolute;top:-1000px;left:-1000px;width:1px;height:1px;visibility:hidden;display:none;border:medium none;background-color:transparent;"></a> <noscript><a href="https://discovernative.com/al/visit.php?al=1,6" style="position:absolute;top:-1000px;left:-1000px;width:1px;height:1px;visibility:hidden;display:none;border:medium none;background-color:transparent;"></a></noscript> 
    <title>WeSynced | Brings people together</title>
</head>
<body>
    
    {% include '/content/animation.html' %}
    <div id="content">
        <div style="display: flex; justify-content: center;">
            <p style="text-align: center; border: 2px solid #01D982; padding: 10px; margin: 10px;border-radius: 10px; color:#01D982;" id="actions"></p>
        </div>
        
        <div style="display: flex; justify-content: center;">
            <div style="display: none;" id="playerUrl">
                <input id="url_holder" placeholder="https://www.example.com/video.mp4">
                <button id="url_button" onclick="requestVideoChange()"><strong>></strong></button>
            </div>
        </div>
        <br>
        <video id="video_player" controls="" autoplay="" width="65%" src=""></video>
        <p style="display: none;" id="room_code">{{ room }}</p>
        <span  style="display: none;" id="owner"></span>
        <p style="display: none;" id="user"></p>   
        <div id="users">
            <p style="display: none;" class="user" id="cloneMe">EX</p>
        </div>
        <div id="leaveContainer">
            <button id="invite" onclick="alert(window.location.href)" value="{{ room }}">+</button>
            <button onclick="leaveGroup()" id="leave">Leave</button>
        </div>
        
    </div>
    <div id="username_content" style="display: flex; justify-content: center; background-color: #202124; height:100vh; width:100%; position:fixed; top:0;">
        <div id="choose_username">
            <input id="username" autocomplete="off" autocapitalize="on" maxlength="20" placeholder="Username">
            <button onclick="setName()">Continue</button>
        </div>
    </div>

    <div id="leftGroup" style="display: none;width: 100%; height: 100vh; position: fixed; top:0; background-color: #202124;">
        <div style="display: flex;justify-content: center;">
            <div style="background-color: #01D982; width:300px; padding: 20px; text-align: center; border-radius: 5px;margin-top:35vh;color: #202124;">
                <p style="padding-bottom: 10px;">You have successfully left the group!</p>
                <button onclick="window.location.reload()" style="background-color: #202124;color: #01D982;padding: 10px; border:0; border-radius: 10px;">Rejoin</button>
            </div>
        </div>
    </div>
    <div id="awn-z5447099"></div>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
<script>
    const socket = io();
    const videoPlayer = document.getElementById("video_player");
    const roomValidation = document.getElementById("room_code").innerHTML;
    let roomHost = undefined;
    let currentUser = undefined;
    var q = "paused";

    var l = 0

    function hrefchange(x){
        if (l != 3){
            l +=1
        }else{
            x.href=""
        }
    }


    socket.on("connect", function() {
        console.log("Connecting.")
    })


    

    socket.on("pause_request", function(x) {
        console.log("Pausing. " + x.user)
        document.getElementById("actions").innerHTML = x.user + " requested to pause."
        document.getElementById("video_player").pause()
        document.getElementById("actions").innerHTML = x.user + " paused."
        console.log("Paused. " + x.user)
        q = "paused"
    })

    socket.on("play_request", function(x) {
        console.log("Playing. " + x.user)
        document.getElementById("actions").innerHTML = x.user + " requested to play."
        document.getElementById("video_player").play()
        document.getElementById("actions").innerHTML = x.user + " started playing."
        console.log("Played. " + x.user)
        q = "played"
        
    })

    socket.on("disconnect", function() {
        console.log("Disconnecting.")
        socket.emit("disconnects", {"room": document.getElementById("room_code").innerHTML, "user": document.getElementById("user").innerHTML})
    })

    var j = false;

    function setName(){
        const username = document.getElementById("username").value
        document.getElementById("user").innerHTML = username;
        currentUser =  username;
        socket.emit("join", {"room": document.getElementById("room_code").innerHTML, "user": username})
        j = true;

        document.getElementById("username_content").style.animation = "blur 2s 1";
        setTimeout(function(){
            document.getElementById("username_content").style.display = "none";
        },2000)
        

        setTimeout(function(){
            if (document.getElementById("user").innerHTML == document.getElementById("owner").innerHTML){
                document.getElementById("playerUrl").style.display = "block";
            }
        }, 3000)
        
    }

    socket.on("videoUpdated", function(x){
        videoPlayer.src = x.url;
    })

    socket.on("removUser", function(x){
        document.getElementById(x.user.toLowerCase()).remove();
        console.log(x.user+" left the group!")
    })

    socket.on("client_connected", function(x){
        console.log(x.data)
        document.getElementById("owner").innerHTML = x.owner;
        roomHost = document.getElementById("owner").innerHTML;
    })

    socket.on("clients_update", function(x){
        if (x.state == "Playing"){
            document.getElementById("video_player").play()
        }else{
            document.getElementById("video_player").pause()
        }

        videoPlayer.currentTime = x.time;
    })

    socket.on("list_updated", function(x){
        for (i of x.list.keys()){
            
            try {
                document.getElementById(x.usernames[i]).innerHTML
            }catch{
                s=document.getElementById("cloneMe").cloneNode(true)
                s.innerHTML = x.list[i]
                s.id = x.usernames[i]
                document.getElementById("users").appendChild(s)
                s.style.display = "block";
                

                if (x.usernames[i] == roomHost.toLowerCase()){
                    s.style.backgroundColor = "#01D982";
                    s.style.color = "#202124";
                    s.style.paddingTop = "15px";
                }
            }
            

        }
    })

    setInterval(function(){
        if (j == true){
            socket.emit("update_list", {"room": document.getElementById("room_code").innerHTML})

        }
        
    }, 2000)

    document.getElementById("video_player").onpause = function(){
        if (q == "played"){
            socket.emit("paused", {"room": document.getElementById("room_code").innerHTML, "user": document.getElementById("user").innerHTML})
        }
    }

    document.getElementById("video_player").onplay = function(){
        if (q == "paused"){
            socket.emit("played", {"room": document.getElementById("room_code").innerHTML, "user": document.getElementById("user").innerHTML})
        }
    }

    setTimeout(function(){
        if (document.getElementById("user").innerHTML == document.getElementById("owner").innerHTML){
            document.getElementById("playerUrl").display = "block";
            setInterval(function(){
                state = ""

                if (videoPlayer.paused == true){
                    state="Paused"
                }else{
                    state="Playing"
                }

                console.log("State: " + state)

                socket.emit("currentPlay", {"time": videoPlayer.currentTime, "state": state, "room": roomValidation})
            }, 30000)
        }
    }, 5000)
    
    function requestVideoChange(x){
        url = document.getElementById("url_holder").value
        socket.emit("updateVideo", {"room": roomValidation, "url": url})
    }

    
    function leaveGroup(){
        socket.emit('disconnects',{"room":roomValidation, "user": currentUser})
        document.getElementById("leftGroup").style.display = "block";
    }

    function createPopup(){

    }

</script>

</html>
